<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{layout/common-layout :: commonLayout(~{this::head},~{this::main} )}">
<head>
<script src="/js/department.js"></script>
<link rel="stylesheet" href="/css/department/side.css" />
<link rel="stylesheet" href="/css/Franchise/fr.css" />
</head>
<body>
	<main class="warp-main">
		<div th:replace="~{department/side :: side}"></div>
		<div class="main">
			<div class="title">
				<h1>매장관리</h1>
			</div>
			<div class="search">
				<div class="name_search">매장명 검색:</div>
				<form onsubmit="searchClicked(this, event)">
					<input class="search-input" type="search" name="search">
					<button class="search-button"></button>
				</form>
			</div>
			<table>
				<thead>
					<tr>
						<th style="width: 160px">매장명</th>
						<th style="width: 380px">주소</th>
						<th style="width: 210px">상세주소</th>
						<th style="width: 160px">전화번호</th>
						<th style="width: 180px">개업일</th>
					</tr>
				</thead>
				<tbody id="dynamic_table">
					<tr th:each="post : ${list}" th:if="${post.closedAt == null}"
						style="margin-left: 84px;">
						<td style="width: 160px" th:text="${post.name}"></td>
						<td style="width: 380px" th:text="${post.address}"></td>
						<td style="width: 210px" th:text="${post.address2}"></td>
						<td style="width: 160px" th:text="${post.ph}"></td>
						<td style="width: 180px"
							th:text="${#temporals.format(post.createdAt)}"></td>
						<td>
						<td><a th:href="|/fredit/${post.id}|"><img
								src="/img/search/detail.png" width="20px" height="20px"></a></td>
					</tr>
				</tbody>
			</table>
			<div class="pagging-wrap">
				<a th:if="${pu.from > 1}" th:href="|/fr?page=${1}|">
					<button>&lt;&lt;</button>
				</a> <a th:if="${pu.from > 1}" th:href="|/fr?page=${pu.from-1}|">
					<button>&lt;</button>
				</a> <span id="pagging"> <a class="btn-page"
					th:each="pno:${#numbers.sequence(pu.from,pu.to)}"
					th:href="|/fr?page=${pno}|">
						<button th:text="${pno}"></button>
				</a>
				</span> <a th:if="${pu.to < pu.tot}" th:href="|/fr?page=${pu.to+1}|">
					<button>&gt;</button>
				</a> <a class="lastPage" th:href="|/fr?page=${pu.tot}|">
					<button>&gt;&gt;</button>
				</a>
			</div>
			<script th:inline="javascript">
				var page = /*[[${param.page}]]*/null;
				var pageLimit = /*[[${pu.pageLimit}]]*/null; //화면에 page개수
				if (page == null)
					page = "1";
				var idx = (parseInt(page) - 1) % pageLimit; //idx = index //한 화면의 페이지개수
				//alert(page);
				//const element = document.getElementsById("pagging");
				//console.log($(".btn-page").eq(idx));
				//$(".btn-page").eq(idx).addClass("target");
				var elements = document.querySelectorAll(".btn-page");
				elements[idx].classList.add("target");

				//eq가 idx와 같다
				function searchClicked(form, event) {
					event.preventDefault(); // 폼 제출 기본 동작 막기

					// 검색어 가져오기
					var searchInput = form
							.querySelector('input[name="search"]');
					var searchQuery = searchInput.value;

					// 검색어를 서버로 전송하여 결과 받아오기
					// 여기서는 간단하게 alert로 표시하도록 하였습니다. 실제로는 서버로 Ajax 요청을 보내야 합니다.

					// 서버에서 받아온 검색 결과를 가지고 필터링하여 화면 업데이트
					filterResults(searchQuery);
				}

				// 검색 결과 필터링 및 화면 업데이트 함수
				function filterResults(searchQuery) {
					var allRows = document
							.querySelectorAll('#dynamic_table tr'); // 모든 매장 행 가져오기

					// 각 행을 순회하면서 검색어와 일치하는 매장만 표시하도록 처리
					allRows
							.forEach(function(row) {
								var storeName = row
										.querySelector('td:nth-child(1)').innerText; // 매장명 가져오기

								// 검색어와 일치하는 매장이면 표시, 아니면 숨김
								if (storeName.includes(searchQuery)) {
									row.style.display = 'table-row'; // 표시
								} else {
									row.style.display = 'none'; // 숨김
								}
							});
				}
			</script>
		</div>
	</main>
</body>
</html>