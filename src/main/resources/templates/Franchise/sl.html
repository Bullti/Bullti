<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{layout/common-layout :: commonLayout(~{this::head},~{this::main} )}">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="/css/Franchise/sl.css" />
</head>
<body>
	<main>
		<div class="title">
			<ul class="ttl">
				<li>매장위치</li>
			</ul>
		</div>
		<div id="map" style="width: 100%; height: 600px;"></div>
		<div id="menu_wrap" class="bg_white">
			<div class="option">
				<div style="padding-top: 20px">
					<form onsubmit="searchPlaces(); return false;">
						매장검색 : <input type="text" id="keyword" size="15">
						<button type="submit">검색하기</button>
					</form>
				</div>
			</div>
			<hr>
			<ul id="placesList"></ul>
			<div id="pagination"></div>
		</div>
		<script type="text/javascript"
			src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0b4d10c092ae135f954caef18aff79de&libraries=services"></script>
		<script>
		// GET 요청 예제
		fetch('/sl/fran')
		  .then(response => {
		    if (!response.ok) {
		      throw new Error('Network response was not ok');
		    }
		    return response.json();
		  })
		  .then(data => {
		    // 성공적으로 응답을 받았을 때의 처리
		    //console.log(data);
		    for (var item of data) {
	    	  //console.log(item.name, item.address, item.ph);
	    	  createMarker(item);
	    	}
		  })
		  .catch(error => {
		    // 오류 발생 시의 처리
		    console.error('Fetch error:', error);
		  });
		
		function getAddressCoords(address) {
			var geocoder = new kakao.maps.services.Geocoder();
		    return new Promise(function(resolve, reject) {
		        geocoder.addressSearch(address, function(result, status) {
		            if (status === kakao.maps.services.Status.OK) {
		                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
		                resolve(coords);
		            } else {
		                reject("주소 검색 실패: " + status);
		            }
		        });
		    });
		}
		
		var positions = [];
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
		mapOption = {
			center : new kakao.maps.LatLng(37.657176635618704,
					127.06227917525834), // 지도의 중심좌표
			level : 10
		// 지도의 확대 레벨
		};

		var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
		
		function createMarker(item){
			// 주소-좌표 변환 객체를 생성합니다
			// 주소로 좌표를 검색합니다
			getAddressCoords(item.address)
			    .then(function(coords) {
			        console.log("좌표: " + coords);
			        // 여기에서 coords를 사용하여 추가 작업을 수행할 수 있습니다.
			        
			        var imageSrc = "/img/location/image.webp";

					// 마커 이미지의 이미지 크기 입니다
					var imageSize = new kakao.maps.Size(80, 90);

					// 마커 이미지를 생성합니다    
					var markerImage = new kakao.maps.MarkerImage(imageSrc,
							imageSize);

					// 마커를 생성합니다
					var marker = new kakao.maps.Marker({
						map : map, // 마커를 표시할 지도
						position : coords, // 마커를 표시할 위치
						//title : item.name, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
						image : markerImage
					// 마커 이미지 
					});
					
					// 인포윈도우로 장소에 대한 설명을 표시합니다
			        var infowindow = new kakao.maps.InfoWindow({
			            content: `<div style="margin-left:33px; width:80px;text-align:center;display: center;padding:6px 0;">${item.name}</div>`
			        });
			        infowindow.open(map, marker);
			    })
			    .catch(function(error) {
			        console.error(error);
			    });
			
			
			// 마커를 표시할 위치와 title 객체 배열입니다 
			/*
			var positions = [ {
				title : '노원 본점',
				latlng : new kakao.maps.LatLng(37.657176, 127.062279)
			}, {
				title : '시청점',
				latlng : new kakao.maps.LatLng(37.563598, 126.977543)
			}, {
				title : '동대문점',
				latlng : new kakao.maps.LatLng(37.570064, 127.014418)
			}, {
				title : '망원점',
				latlng : new kakao.maps.LatLng(37.555737, 126.910691)
			} ];
			*/
			/* 
			// 마커 이미지의 이미지 주소입니다
			var imageSrc = "/img/location/image.webp";

			for (var i = 0; i < positions.length; i++) {

				// 마커 이미지의 이미지 크기 입니다
				var imageSize = new kakao.maps.Size(110, 120);

				// 마커 이미지를 생성합니다    
				var markerImage = new kakao.maps.MarkerImage(imageSrc,
						imageSize);

				// 마커를 생성합니다
				var marker = new kakao.maps.Marker({
					map : map, // 마커를 표시할 지도
					position : positions[i].latlng, // 마커를 표시할 위치
					title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
					image : markerImage
				// 마커 이미지 
				});
				
			}
			 */
		}
		</script>
	</main>
</body>
</html>